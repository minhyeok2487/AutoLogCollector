<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoLogCollector</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-logo">
                <span class="logo-icon">‚ö°</span>
                <span class="logo-text">AutoLog</span>
            </div>
            <nav class="sidebar-nav">
                <button class="nav-item active" data-section="execution" onclick="showSection('execution')">
                    <span class="nav-icon">‚ñ∂</span>
                    <span class="nav-text">Execution</span>
                </button>
                <button class="nav-item" data-section="results" onclick="showSection('results')">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Results</span>
                </button>
                <button class="nav-item" data-section="logs" onclick="showSection('logs')">
                    <span class="nav-icon">üìã</span>
                    <span class="nav-text">Live Logs</span>
                </button>
                <button class="nav-item" data-section="schedule" onclick="showSection('schedule')">
                    <span class="nav-icon">‚è∞</span>
                    <span class="nav-text">Schedule</span>
                </button>
            </nav>
            <div class="sidebar-footer">
                <button class="nav-item" onclick="openLogsFolder()">
                    <span class="nav-icon">üìÅ</span>
                    <span class="nav-text">Open Folder</span>
                </button>
                <button class="nav-item" onclick="toggleSettingsMenu()">
                    <span class="nav-icon">‚öô</span>
                    <span class="nav-text">Settings</span>
                </button>
                <div class="dropdown-menu" id="settingsMenu">
                    <button onclick="showSmtpSettings(); closeSettingsMenu();">SMTP Settings</button>
                    <button onclick="checkForUpdates(); closeSettingsMenu();">Check for Updates</button>
                    <button onclick="showAboutModal(); closeSettingsMenu();">About</button>
                    <div class="dropdown-divider"></div>
                    <span class="dropdown-info" id="versionInfo">v1.1.2</span>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <div class="main-wrapper">
            <!-- Top Toolbar -->
            <header class="toolbar">
                <div class="toolbar-left">
                    <h1 id="sectionTitle">Execution</h1>
                </div>
                <div class="toolbar-right">
                    <div class="toolbar-status">
                        <span class="status-dot" id="statusDot"></span>
                        <span id="statusText">Ready</span>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <main class="content-area">
                <!-- Execution Section -->
                <section class="content-section" id="executionSection">
                    <div class="panel">
                        <div class="panel-header">
                            <h2>Connection Settings</h2>
                        </div>
                        <div class="panel-body">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Username</label>
                                    <input type="text" id="username" placeholder="SSH username">
                                </div>
                                <div class="form-group">
                                    <label>Password</label>
                                    <input type="password" id="password" placeholder="SSH password">
                                </div>
                                <div class="form-group form-group-small">
                                    <label>Timeout <span class="help-icon" title="Îç∞Ïù¥ÌÑ∞ Ï≤≠ÌÅ¨ Í∞Ñ ÎåÄÍ∏∞ ÏãúÍ∞Ñ(Ï¥à). ÏÑúÎ≤Ñ ÏùëÎãµÏù¥ ÎäêÎ¶¨Î©¥ Í∞íÏùÑ ÎÜíÏù¥ÏÑ∏Ïöî.">?</span></label>
                                    <input type="number" id="timeout" min="1" max="60" value="1">
                                </div>
                            </div>
                            <div class="options-row">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="disablePaging" checked>
                                    Disable Paging <span class="help-icon" title="terminal length 0 Î™ÖÎ†π Ïã§Ìñâ. Ï∂úÎ†•Ïù¥ ÌéòÏù¥ÏßÄ Îã®ÏúÑÎ°ú ÎÅäÍ∏∞ÏßÄ ÏïäÍ≥† Ï†ÑÏ≤¥ Ï∂úÎ†•Îê®. Cisco IOS Ïû•ÎπÑÏóêÏÑú ÏÇ¨Ïö©.">?</span>
                                </label>
                                <label class="checkbox-label">
                                    <input type="checkbox" id="autoExportExcel" checked>
                                    Auto Export Excel <span class="help-icon" title="Ïã§Ìñâ ÏôÑÎ£å ÌõÑ ÏûêÎèôÏúºÎ°ú Excel ÌååÏùº ÏÉùÏÑ±.">?</span>
                                </label>
                            </div>
                            <div class="options-row">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="enableMode" onchange="toggleEnablePassword()">
                                    Enable Mode <span class="help-icon" title="enable Î™ÖÎ†πÏúºÎ°ú privileged EXEC Î™®Îìú ÏßÑÏûÖ. Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÌïÑÏöîÌïú Î™ÖÎ†π Ïã§Ìñâ Ïãú ÌïÑÏöî.">?</span>
                                </label>
                                <div class="enable-password-options" id="enablePasswordOptions" style="display: none;">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="samePassword" checked onchange="toggleEnablePasswordInput()">
                                        Î°úÍ∑∏Ïù∏ Ìå®Ïä§ÏõåÎìúÏôÄ ÎèôÏùº
                                    </label>
                                    <input type="password" id="enablePassword" placeholder="Enable password" style="display: none;">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel">
                        <div class="panel-header">
                            <h2>Target Servers</h2>
                            <div class="panel-actions">
                                <button type="button" class="btn-secondary" onclick="importCSV()">Import CSV</button>
                                <button type="button" class="btn-secondary" onclick="exportCSV()">Export CSV</button>
                                <button type="button" class="btn-secondary" onclick="addServerRow()">+ Add</button>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="table-container">
                                <table class="data-table" id="serversTable">
                                    <thead>
                                        <tr>
                                            <th>IP Address</th>
                                            <th>Hostname</th>
                                            <th style="width: 40px;" title="Per-server credentials">Auth</th>
                                            <th style="width: 40px;"></th>
                                        </tr>
                                    </thead>
                                    <tbody id="serversBody">
                                    </tbody>
                                </table>
                            </div>
                            <div class="item-count-bar">
                                <span id="serverCount">0</span> servers configured
                            </div>
                        </div>
                    </div>

                    <div class="panel">
                        <div class="panel-header">
                            <h2>Commands</h2>
                            <div class="panel-actions">
                                <button type="button" class="btn-secondary" onclick="importCommandsTxt()">Import TXT</button>
                                <button type="button" class="btn-secondary" onclick="exportCommandsTxt()">Export TXT</button>
                                <span class="item-count"><span id="commandCount">0</span> commands</span>
                            </div>
                        </div>
                        <div class="panel-body">
                            <textarea id="commandsInput" class="commands-textarea" placeholder="Enter commands (one per line)...
Example:
show version
show ip int br
show run"></textarea>
                        </div>
                    </div>

                    <div class="action-bar">
                        <button id="runBtn" class="btn-primary btn-large" onclick="startExecution()">
                            <span class="btn-icon">‚ñ∂</span> Run Execution
                        </button>
                        <button id="stopBtn" class="btn-danger btn-large" onclick="stopExecution()" disabled>
                            <span class="btn-icon">‚ñ†</span> Stop
                        </button>
                    </div>

                    <!-- Progress Panel -->
                    <div class="panel" id="progressSection" style="display: none;">
                        <div class="panel-header">
                            <h2>Progress</h2>
                        </div>
                        <div class="panel-body">
                            <div class="progress-bar">
                                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                            </div>
                            <div class="progress-info">
                                <span id="progressText">0 / 0</span>
                                <span id="currentServer"></span>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Results Section -->
                <section class="content-section" id="resultsSection" style="display: none;">
                    <div class="panel">
                        <div class="panel-header">
                            <h2>Execution Results</h2>
                            <button class="btn-success" onclick="exportResults()">Export Excel</button>
                        </div>
                        <div class="panel-body">
                            <div class="summary-bar" id="summary"></div>
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Hostname</th>
                                            <th>IP Address</th>
                                            <th>Status</th>
                                            <th>Duration</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="resultsBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Live Logs Section -->
                <section class="content-section" id="logsSection" style="display: none;">
                    <div class="panel panel-full">
                        <div class="panel-header">
                            <h2>Live Logs</h2>
                            <div class="panel-actions">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="autoScroll" checked>
                                    Auto-scroll
                                </label>
                                <button class="btn-secondary" onclick="clearLiveLogs()">Clear</button>
                            </div>
                        </div>
                        <div class="panel-body panel-body-logs">
                            <div class="server-tabs" id="serverTabs">
                            </div>
                            <div class="logs-view">
                                <pre class="log-content" id="combinedLogContent"></pre>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Schedule Section -->
                <section class="content-section" id="scheduleSection" style="display: none;">
                    <div class="panel">
                        <div class="panel-header">
                            <h2>Scheduled Tasks</h2>
                            <div class="panel-actions">
                                <button class="btn-primary" onclick="showScheduleForm()">+ New Schedule</button>
                            </div>
                        </div>
                        <div class="panel-body">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Type</th>
                                            <th>Time</th>
                                            <th>Next Run</th>
                                            <th>Last Run</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="schedulesBody">
                                    </tbody>
                                </table>
                            </div>
                            <div class="empty-state" id="noSchedules">
                                <p>No scheduled tasks. Click "+ New Schedule" to create one.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </main>

            <!-- Status Bar -->
            <footer class="status-bar">
                <div class="status-left">
                    <span id="connectionInfo">No active connections</span>
                </div>
                <div class="status-right">
                    <span id="versionStatus"></span>
                </div>
            </footer>
        </div>

        <!-- Update Modal -->
        <div class="modal-overlay" id="updateModal" style="display: none;">
            <div class="modal">
                <div class="modal-header">
                    <h2>Update Available</h2>
                    <button class="close-btn" onclick="closeUpdateModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="updateVersionInfo"></p>
                    <div id="updateReleaseNotes" class="release-notes"></div>
                    <div id="updateProgress" class="update-progress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="updateProgressFill" style="width: 0%"></div>
                        </div>
                        <p id="updateProgressText">Downloading...</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="downloadUpdateBtn" class="btn-primary" onclick="downloadUpdate()">Download & Install</button>
                    <button id="restartBtn" class="btn-primary" onclick="restartApp()" style="display: none;">Restart Now</button>
                    <button class="btn-secondary" onclick="closeUpdateModal()">Later</button>
                </div>
            </div>
        </div>

        <!-- Log Viewer Modal -->
        <div class="modal-overlay" id="logViewerModal" style="display: none;">
            <div class="modal modal-large">
                <div class="modal-header">
                    <h2>Log Viewer</h2>
                    <button class="close-btn" onclick="closeLogViewer()">&times;</button>
                </div>
                <div class="modal-body">
                    <h3 id="logTitle"></h3>
                    <pre class="log-viewer-content" id="logContent"></pre>
                </div>
            </div>
        </div>

        <!-- Schedule Form Modal -->
        <div class="modal-overlay" id="scheduleModal" style="display: none;">
            <div class="modal modal-large">
                <div class="modal-header">
                    <h2 id="scheduleModalTitle">New Schedule</h2>
                    <button class="close-btn" onclick="closeScheduleForm()">&times;</button>
                </div>
                <div class="modal-body schedule-form">
                    <input type="hidden" id="scheduleId">

                    <div class="form-section">
                        <h3>Basic Info</h3>
                        <div class="form-group">
                            <label>Schedule Name</label>
                            <input type="text" id="scheduleName" placeholder="e.g., Daily Backup Check">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Credentials</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Username</label>
                                <input type="text" id="scheduleFormUsername" placeholder="SSH username">
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" id="scheduleFormPassword" placeholder="SSH password">
                            </div>
                            <div class="form-group">
                                <label>Enable Password</label>
                                <input type="password" id="scheduleFormEnablePassword" placeholder="Optional">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Schedule Type</h3>
                        <div class="schedule-type-selector">
                            <label class="radio-card">
                                <input type="radio" name="scheduleType" value="daily" checked onchange="updateScheduleOptions()">
                                <span class="radio-card-content">
                                    <span class="radio-card-title">Daily</span>
                                    <span class="radio-card-desc">Run every day</span>
                                </span>
                            </label>
                            <label class="radio-card">
                                <input type="radio" name="scheduleType" value="weekly" onchange="updateScheduleOptions()">
                                <span class="radio-card-content">
                                    <span class="radio-card-title">Weekly</span>
                                    <span class="radio-card-desc">Run on specific days</span>
                                </span>
                            </label>
                            <label class="radio-card">
                                <input type="radio" name="scheduleType" value="monthly" onchange="updateScheduleOptions()">
                                <span class="radio-card-content">
                                    <span class="radio-card-title">Monthly</span>
                                    <span class="radio-card-desc">Run on specific date</span>
                                </span>
                            </label>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Time</label>
                                <input type="time" id="scheduleTime" value="09:00">
                            </div>
                        </div>

                        <div id="weeklyOptions" style="display: none;">
                            <label>Days of Week</label>
                            <div class="days-selector">
                                <label class="day-checkbox"><input type="checkbox" value="0"> Sun</label>
                                <label class="day-checkbox"><input type="checkbox" value="1" checked> Mon</label>
                                <label class="day-checkbox"><input type="checkbox" value="2" checked> Tue</label>
                                <label class="day-checkbox"><input type="checkbox" value="3" checked> Wed</label>
                                <label class="day-checkbox"><input type="checkbox" value="4" checked> Thu</label>
                                <label class="day-checkbox"><input type="checkbox" value="5" checked> Fri</label>
                                <label class="day-checkbox"><input type="checkbox" value="6"> Sat</label>
                            </div>
                        </div>

                        <div id="monthlyOptions" style="display: none;">
                            <div class="form-group">
                                <label>Day of Month</label>
                                <select id="dayOfMonth">
                                    <option value="1">1st</option>
                                    <option value="2">2nd</option>
                                    <option value="3">3rd</option>
                                    <option value="4">4th</option>
                                    <option value="5">5th</option>
                                    <option value="6">6th</option>
                                    <option value="7">7th</option>
                                    <option value="8">8th</option>
                                    <option value="9">9th</option>
                                    <option value="10">10th</option>
                                    <option value="11">11th</option>
                                    <option value="12">12th</option>
                                    <option value="13">13th</option>
                                    <option value="14">14th</option>
                                    <option value="15">15th</option>
                                    <option value="16">16th</option>
                                    <option value="17">17th</option>
                                    <option value="18">18th</option>
                                    <option value="19">19th</option>
                                    <option value="20">20th</option>
                                    <option value="21">21st</option>
                                    <option value="22">22nd</option>
                                    <option value="23">23rd</option>
                                    <option value="24">24th</option>
                                    <option value="25">25th</option>
                                    <option value="26">26th</option>
                                    <option value="27">27th</option>
                                    <option value="28">28th</option>
                                    <option value="29">29th</option>
                                    <option value="30">30th</option>
                                    <option value="31">31st</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Execution Options</h3>
                        <div class="form-row">
                            <div class="form-group form-group-small">
                                <label>Timeout (sec)</label>
                                <input type="number" id="scheduleTimeout" min="1" max="60" value="1">
                            </div>
                        </div>
                        <div class="options-row">
                            <label class="checkbox-label">
                                <input type="checkbox" id="scheduleDisablePaging" checked>
                                Disable Paging
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="scheduleAutoExportExcel" checked>
                                Auto Export Excel
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="scheduleEnableMode">
                                Enable Mode
                            </label>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Email Notification</h3>
                        <div class="options-row">
                            <label class="checkbox-label">
                                <input type="checkbox" id="scheduleEmailEnabled" onchange="toggleEmailOptions()">
                                Send Email on Completion
                            </label>
                        </div>
                        <div id="emailOptions" style="display: none;">
                            <div class="form-group">
                                <label>To (recipients, comma separated)</label>
                                <input type="text" id="scheduleEmailTo" placeholder="user@example.com">
                            </div>
                            <p class="form-hint">SMTP settings are configured in Settings > SMTP Settings.</p>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Target Servers</h3>
                        <div class="form-actions">
                            <button type="button" class="btn-secondary btn-small" onclick="importScheduleCSV()">Import CSV</button>
                            <button type="button" class="btn-secondary btn-small" onclick="exportScheduleCSV()">Export CSV</button>
                            <button type="button" class="btn-secondary btn-small" onclick="copyServersFromExecution()">Copy from Execution</button>
                            <button type="button" class="btn-secondary btn-small" onclick="addScheduleServerRow()">+ Add</button>
                        </div>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>IP Address</th>
                                        <th>Hostname</th>
                                        <th style="width: 40px;">Auth</th>
                                        <th style="width: 40px;"></th>
                                    </tr>
                                </thead>
                                <tbody id="scheduleServersBody">
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Commands</h3>
                        <div class="form-actions">
                            <button type="button" class="btn-secondary btn-small" onclick="importScheduleCommandsTxt()">Import TXT</button>
                            <button type="button" class="btn-secondary btn-small" onclick="exportScheduleCommandsTxt()">Export TXT</button>
                            <button type="button" class="btn-secondary btn-small" onclick="copyCommandsFromExecution()">Copy from Execution</button>
                        </div>
                        <textarea id="scheduleCommands" class="commands-textarea" placeholder="Enter commands (one per line)..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-primary" onclick="saveSchedule()">Save Schedule</button>
                    <button class="btn-secondary" onclick="closeScheduleForm()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Server Credentials Modal -->
    <div class="modal-overlay" id="serverCredModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h2>Server Credentials</h2>
                <button class="close-btn" onclick="closeServerCredModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p class="server-cred-info" id="serverCredInfo"></p>
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="serverCredUsername" placeholder="Leave empty to use global">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="serverCredPassword" placeholder="Leave empty to use global">
                </div>
                <div class="form-group">
                    <label>Enable Password</label>
                    <input type="password" id="serverCredEnablePassword" placeholder="Leave empty to use global">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="saveServerCred()">Save</button>
                <button class="btn-secondary" onclick="clearServerCred()">Clear</button>
                <button class="btn-secondary" onclick="closeServerCredModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div class="modal-overlay" id="aboutModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h2>About</h2>
                <button class="close-btn" onclick="closeAboutModal()">&times;</button>
            </div>
            <div class="modal-body about-body">
                <div class="about-icon">‚ö°</div>
                <h3 class="about-title">AutoLogCollector</h3>
                <p class="about-version" id="aboutVersion">v1.1.2</p>
                <div class="about-description">
                    <p>Cisco ÎÑ§Ìä∏ÏõåÌÅ¨ Ïû•ÎπÑ SSH ÏûêÎèôÌôî ÎèÑÍµ¨ÏûÖÎãàÎã§.</p>
                    <p>Îã§ÏàòÏùò Ïû•ÎπÑÏóê SSH Ï†ëÏÜçÌïòÏó¨ Î™ÖÎ†πÏñ¥Î•º ÏùºÍ¥Ñ Ïã§ÌñâÌïòÍ≥† Í≤∞Í≥ºÎ•º ÏàòÏßëÌï©ÎãàÎã§.</p>
                </div>
                <div class="about-license">
                    <span class="about-license-badge">Freeware</span>
                    <p>Î≥∏ ÏÜåÌîÑÌä∏Ïõ®Ïñ¥Îäî ÌîÑÎ¶¨Ïõ®Ïñ¥Ïù¥Î©∞, Í∏∞ÏóÖ ÌôòÍ≤ΩÏùÑ Ìè¨Ìï®ÌïòÏó¨ ÎàÑÍµ¨ÎÇò ÏûêÏú†Î°≠Í≤å ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.</p>
                </div>
                <div class="about-footer-info">
                    <p>Developed by Ïù¥ÎØºÌòÅ</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeAboutModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- SMTP Settings Modal -->
    <div class="modal-overlay" id="smtpModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h2>SMTP Settings</h2>
                <button class="close-btn" onclick="closeSmtpSettings()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>SMTP Server</label>
                    <input type="text" id="smtpServer" placeholder="smtp.worksmobile.com">
                </div>
                <div class="form-group form-group-small">
                    <label>Port</label>
                    <input type="number" id="smtpPort" value="587" min="1" max="65535">
                </div>
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="smtpUsername" placeholder="user@example.com">
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="smtpPassword" placeholder="App password">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="saveSmtpSettings()">Save</button>
                <button class="btn-secondary" onclick="closeSmtpSettings()">Cancel</button>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
</body>
</html>
